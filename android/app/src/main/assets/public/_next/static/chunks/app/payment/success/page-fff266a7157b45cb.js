(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7478],{5512:function(e,t,n){Promise.resolve().then(n.bind(n,4375))},8025:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.356.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,n(843).Z)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]])},4187:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.356.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,n(843).Z)("CircleCheckBig",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},9580:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.356.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,n(843).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},8792:function(e,t,n){"use strict";n.d(t,{default:function(){return s.a}});var r=n(5250),s=n.n(r)},4375:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return b}});var r=n(7437),s=n(2265),i=n(7907),a=n(5671),o=n(575),l=n(9580),c=n(4187),u=n(9724),d=n(843);/**
 * @license lucide-react v0.356.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let f=(0,d.Z)("Terminal",[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]]),m=(0,d.Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);var p=n(8025),h=n(8792),y=n(6862),x=n(6210),g=n(1776),v=n(9069);function b(){let e=(0,i.useRouter)(),t=(0,i.useSearchParams)(),{toast:n}=(0,y.pm)(),{firebaseServices:d,isReady:b,user:j}=(0,x.useAuth)(),[w,N]=(0,s.useState)("idle"),[C,k]=(0,s.useState)(null),[Z,S]=(0,s.useState)(!1),[P,R]=(0,s.useState)(!1),E="firebase deploy --only functions",z=(0,s.useRef)(!1),T=(0,s.useRef)(0);return((0,s.useEffect)(()=>{let r=t.get("session_id");if(b){if(b&&!j){k("You must be signed in to finalize a payment."),N("error");return}if(j&&!z.current){if(z.current=!0,!r){n({title:"Invalid Access",description:"This page was accessed without a valid payment session.",variant:"destructive"}),e.replace("/");return}let t=async e=>{N("processing");try{if(!(null==d?void 0:d.functions))throw Error("Firebase services are not available. Cannot finalize payment.");let t=(0,g.V1)(d.functions,"finalizeStripePayment"),r=(await t({sessionId:e})).data;if(!r.success)throw Error(r.message||"Failed to process payment session.");n({title:"Payment Successful!",description:"Your account has been updated."}),N("success")}catch(a){let r=a.message||"An unknown error occurred.";console.error("Error calling finalizeStripePayment function:",a);let s="functions/not-found"===a.code||r.toLowerCase().includes("not found"),i=r.includes("does not exist");s&&!i&&T.current<5?(T.current++,console.log("Stripe session not found. Retrying in ".concat(2,"s... (Attempt ").concat(T.current,"/").concat(5,")")),setTimeout(()=>t(e),2e3)):(i?(k("The server-side payment function has not been deployed yet."),S(!0)):s?(k("This payment link has expired or has already been used. Each payment attempt generates a new, one-time use link."),R(!0)):"functions/unauthenticated"===a.code||"functions/permission-denied"===a.code?k("Authentication error. You don't have permission to perform this action. Please sign in again."):k(r),N("error"),n({title:"Payment Processing Error",description:"There was an issue updating your account. Please contact support if you believe you were charged.",variant:"destructive",duration:8e3}))}};t(r)}}},[b,j,e,t,n,d]),(0,s.useEffect)(()=>{if("success"===w){let t=setTimeout(()=>{e.replace("/account/balance")},3e3);return()=>clearTimeout(t)}},[w,e]),"processing"===w||"idle"===w)?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-[calc(100vh-10rem)]",children:(0,r.jsx)(a.Zb,{className:"w-full max-w-lg text-center shadow-xl",children:(0,r.jsxs)(a.Ol,{children:[(0,r.jsx)("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-blue-100",children:(0,r.jsx)(l.Z,{className:"h-8 w-8 text-blue-600 animate-spin"})}),(0,r.jsx)(a.ll,{className:"mt-4 text-2xl font-bold",children:"Processing Payment"}),(0,r.jsx)(a.SZ,{children:"Securely finalizing your transaction and updating your account. Please wait, this may take a moment..."})]})})}):(0,r.jsx)("div",{className:"flex items-center justify-center min-h-[calc(100vh-10rem)]",children:(0,r.jsxs)(a.Zb,{className:"w-full max-w-lg text-center shadow-xl",children:[(0,r.jsxs)(a.Ol,{children:["success"===w&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-green-100",children:(0,r.jsx)(c.Z,{className:"h-8 w-8 text-green-600"})}),(0,r.jsx)(a.ll,{className:"mt-4 text-2xl font-bold",children:"Payment Successful!"}),(0,r.jsx)(a.SZ,{children:"Thank you! Your account has been updated. You will be redirected shortly."})]}),"error"===w&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-red-100",children:(0,r.jsx)(u.Z,{className:"h-8 w-8 text-red-600"})}),(0,r.jsx)(a.ll,{className:"mt-4 text-2xl font-bold text-destructive",children:"Payment Error"}),(0,r.jsx)(a.SZ,{children:Z?"Could not connect to the server-side payment service.":C})]})]}),(0,r.jsxs)(a.aY,{className:"space-y-4",children:[Z&&(0,r.jsxs)(v.bZ,{className:"text-left",children:[(0,r.jsx)(f,{className:"h-4 w-4"}),(0,r.jsx)(v.Cd,{children:"Action Required: Deploy Server Functions"}),(0,r.jsxs)(v.X,{children:["To complete payments, the server-side logic must be deployed. Open a terminal in your project's root directory and run this command:",(0,r.jsxs)("div",{className:"mt-2 p-2 bg-secondary/50 rounded-md font-mono text-sm flex justify-between items-center",children:[(0,r.jsx)("code",{children:E}),(0,r.jsx)(o.z,{variant:"outline",size:"sm",onClick:()=>{navigator.clipboard.writeText(E).then(()=>{n({title:"Command Copied!",description:"Paste it into your terminal to deploy."})}).catch(e=>{n({variant:"destructive",title:"Copy Failed",description:"Could not copy command."})})},children:"Copy"})]}),"After deployment, try the payment process again."]})]}),P&&(0,r.jsxs)(v.bZ,{className:"text-left",children:[(0,r.jsx)(m,{className:"h-4 w-4"}),(0,r.jsx)(v.Cd,{children:"Expired Payment Session"}),(0,r.jsx)(v.X,{children:"This can happen if you refresh the success page or reuse an old link. Please start a new payment from the deposit page."})]}),"success"===w&&(0,r.jsx)(o.z,{asChild:!0,children:(0,r.jsxs)(h.default,{href:"/account/balance",children:["Go to My Account ",(0,r.jsx)(p.Z,{className:"ml-2 h-4 w-4"})]})}),"error"===w&&(0,r.jsx)(o.z,{asChild:!0,children:(0,r.jsxs)(h.default,{href:"/deposit",children:["Start a New Payment ",(0,r.jsx)(p.Z,{className:"ml-2 h-4 w-4"})]})})]})]})})}},575:function(e,t,n){"use strict";n.d(t,{d:function(){return l},z:function(){return c}});var r=n(7437),s=n(2265),i=n(9143),a=n(9769),o=n(2169);let l=(0,a.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:n,variant:s,size:a,asChild:c=!1,...u}=e,d=c?i.g7:"button";return(0,r.jsx)(d,{className:(0,o.cn)(l({variant:s,size:a,className:n})),ref:t,...u})});c.displayName="Button"},5671:function(e,t,n){"use strict";n.d(t,{Ol:function(){return o},SZ:function(){return c},Zb:function(){return a},aY:function(){return u},eW:function(){return d},ll:function(){return l}});var r=n(7437),s=n(2265),i=n(2169);let a=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",n),...s})});a.displayName="Card";let o=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",n),...s})});o.displayName="CardHeader";let l=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)("h3",{ref:t,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",n),...s})});l.displayName="CardTitle";let c=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)("p",{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",n),...s})});c.displayName="CardDescription";let u=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("p-6 pt-0",n),...s})});u.displayName="CardContent";let d=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",n),...s})});d.displayName="CardFooter"},1266:function(e,t,n){"use strict";n.d(t,{F:function(){return i},e:function(){return a}});var r=n(2265);function s(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function i(...e){return t=>{let n=!1,r=e.map(e=>{let r=s(e,t);return n||"function"!=typeof r||(n=!0),r});if(n)return()=>{for(let t=0;t<r.length;t++){let n=r[t];"function"==typeof n?n():s(e[t],null)}}}}function a(...e){return r.useCallback(i(...e),e)}},9143:function(e,t,n){"use strict";n.d(t,{Z8:function(){return a},g7:function(){return o},sA:function(){return c}});var r=n(2265),s=n(1266),i=n(7437);function a(e){let t=function(e){let t=r.forwardRef((e,t)=>{let{children:n,...i}=e;if(r.isValidElement(n)){let e,a;let o=(e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?n.props.ref:n.props.ref||n.ref,l=function(e,t){let n={...t};for(let r in t){let s=e[r],i=t[r];/^on[A-Z]/.test(r)?s&&i?n[r]=(...e)=>{let t=i(...e);return s(...e),t}:s&&(n[r]=s):"style"===r?n[r]={...s,...i}:"className"===r&&(n[r]=[s,i].filter(Boolean).join(" "))}return{...e,...n}}(i,n.props);return n.type!==r.Fragment&&(l.ref=t?(0,s.F)(t,o):o),r.cloneElement(n,l)}return r.Children.count(n)>1?r.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}(e),n=r.forwardRef((e,n)=>{let{children:s,...a}=e,o=r.Children.toArray(s),l=o.find(u);if(l){let e=l.props.children,s=o.map(t=>t!==l?t:r.Children.count(e)>1?r.Children.only(null):r.isValidElement(e)?e.props.children:null);return(0,i.jsx)(t,{...a,ref:n,children:r.isValidElement(e)?r.cloneElement(e,void 0,s):null})}return(0,i.jsx)(t,{...a,ref:n,children:s})});return n.displayName=`${e}.Slot`,n}var o=a("Slot"),l=Symbol("radix.slottable");function c(e){let t=({children:e})=>(0,i.jsx)(i.Fragment,{children:e});return t.displayName=`${e}.Slottable`,t.__radixId=l,t}function u(e){return r.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===l}}},function(e){e.O(0,[4358,139,7192,5596,5250,7992,6210,2971,8069,1744],function(){return e(e.s=5512)}),_N_E=e.O()}]);