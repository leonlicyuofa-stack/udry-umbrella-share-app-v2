"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6210],{9069:function(e,t,a){a.d(t,{Cd:function(){return u},X:function(){return c},bZ:function(){return o}});var r=a(7437),s=a(2265),i=a(9769),n=a(2169);let l=(0,i.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),o=s.forwardRef((e,t)=>{let{className:a,variant:s,...i}=e;return(0,r.jsx)("div",{ref:t,role:"alert",className:(0,n.cn)(l({variant:s}),a),...i})});o.displayName="Alert";let u=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("h5",{ref:t,className:(0,n.cn)("mb-1 font-medium leading-none tracking-tight",a),...s})});u.displayName="AlertTitle";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("text-sm [&_p]:leading-relaxed",a),...s})});c.displayName="AlertDescription"},6210:function(e,t,a){a.r(t),a.d(t,{AuthProvider:function(){return m},useAuth:function(){return g},useStalls:function(){return v}});var r=a(7437),s=a(2265),i=a(7907),n=a(7065),l=a(8121),o=a(1221),u=a(6862),c=a(3790),d=a(9069),f=a(9724);let p=(0,s.createContext)(void 0);function v(){let[e,t]=(0,s.useState)([]),[a,r]=(0,s.useState)(!0),{toast:i}=(0,u.pm)(),n=(0,o.I)();return(0,s.useEffect)(()=>{if(!n){r(!1);return}let e=(0,l.hJ)(n.db,"stalls"),a=(0,l.cf)(e,e=>{t(e.docs.map(e=>({...e.data(),dvid:e.id,id:e.id}))),r(!1)},e=>{console.error("Error fetching stalls:",e),i({variant:"destructive",title:"Error",description:"Could not load stall locations."}),r(!1)});return()=>a()},[n,i]),{stalls:e,isLoadingStalls:a}}function h(){let{translate:e}=(0,c.useLanguage)();return(0,r.jsx)("div",{className:"flex items-center justify-center h-[calc(100vh-10rem)] p-4",children:(0,r.jsxs)(d.bZ,{variant:"destructive",className:"max-w-3xl",children:[(0,r.jsx)(f.Z,{className:"h-4 w-4"}),(0,r.jsx)(d.Cd,{children:"Firebase Configuration Error"}),(0,r.jsxs)(d.X,{children:[(0,r.jsx)("p",{className:"mb-2",children:"The application could not connect to Firebase services. This is usually because the necessary configuration keys are missing or incorrect."}),(0,r.jsxs)("ul",{className:"list-disc pl-5 space-y-1 text-xs",children:[(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Action Required:"})," Please ensure all `NEXT_PUBLIC_FIREBASE_*` variables are correctly set in your environment."]}),(0,r.jsx)("li",{children:"If the issue persists, ensure all keys are correctly set in your environment."}),(0,r.jsx)("li",{children:"You may need to restart the development server or re-deploy for changes to take effect."})]})]})]})})}function m(e){let{children:t}=e,[a,d]=(0,s.useState)(null),[f,v]=(0,s.useState)(null),[m,g]=(0,s.useState)(!1),{toast:_}=(0,u.pm)(),{translate:b}=(0,c.useLanguage)(),[y,S]=(0,s.useState)(!1),[w,A]=(0,s.useState)(null),[I,E]=(0,s.useState)(!0),T=(0,i.useRouter)(),[x,N]=(0,s.useState)(null),[F,C]=(0,s.useState)(!1);if((0,s.useEffect)(()=>{let e=(0,o.I)();if(!e){console.error("Auth Context: Firebase services failed to initialize."),C(!0),g(!0),E(!1);return}N(e),C(!1);let t=(0,n.Aj)(e.auth,e=>{d(e),e||(v(null),A(null),E(!1)),g(!0)});return()=>{t()}},[_]),(0,s.useEffect)(()=>{if(!x||!a)return;E(!0);let e=(0,l.JU)(x.db,"users",a.uid),t=(0,l.cf)(e,async t=>{if(t.exists()){let e=t.data();v(e),A(e.activeRental||null)}else{let t={email:a.email,displayName:a.displayName,photoURL:a.photoURL,deposit:0,balance:0,hasHadFirstFreeRental:!1,createdAt:(0,l.Bt)(),activeRental:null};await (0,l.pl)(e,t),v({uid:a.uid,...t}),A(null),a.isAnonymous||S(!0)}E(!1)});return()=>t()},[a,x]),F)return(0,r.jsx)(h,{});let D=async()=>{if(!(null==x?void 0:x.auth))return;let e=new n.hJ;try{await (0,n.F6)(x.auth,e)}catch(e){_({variant:"destructive",title:b("auth_error_signin_google_failed"),description:e.message})}},R=async()=>{if(!(null==x?void 0:x.auth))return;let e=new n.O4("apple.com");try{await (0,n.F6)(x.auth,e)}catch(e){_({variant:"destructive",title:b("auth_error_signin_apple_failed"),description:e.message})}},U=async e=>{let{name:t,email:a,password:r}=e;if((null==x?void 0:x.auth)&&x.db)try{let e=await (0,n.Xb)(x.auth,a,r);await (0,n.ck)(e.user,{displayName:t}),_({title:b("auth_success_signup_email")})}catch(e){throw _({variant:"destructive",title:b("auth_error_signup_email_failed"),description:e.message}),e}},O=async e=>{let{email:t,password:a}=e;if(null==x?void 0:x.auth)try{await (0,n.e5)(x.auth,t,a),_({title:b("auth_success_signin_email")})}catch(t){let e=t.message;throw"auth/invalid-credential"===t.code&&(e=b("auth_error_invalid_credential_desc")),_({variant:"destructive",title:b("auth_error_signin_email_failed"),description:e}),t}},j=async()=>{if(null==x?void 0:x.auth)try{await (0,n.w7)(x.auth),T.push("/"),_({title:b("auth_success_signout")})}catch(e){_({variant:"destructive",title:b("auth_error_signout_failed"),description:e.message})}},P=async e=>{if(a&&(null==x?void 0:x.auth.currentUser)){if(e.newPassword!==e.confirmNewPassword)throw _({variant:"destructive",title:b("toast_password_mismatch")}),Error("Passwords don't match");try{let t=n.w9.credential(x.auth.currentUser.email,e.currentPassword);await (0,n.aF)(x.auth.currentUser,t),await (0,n.gQ)(x.auth.currentUser,e.newPassword),_({title:b("toast_password_change_success_title"),description:b("toast_password_change_success_desc")})}catch(e){throw _({variant:"destructive",title:b("toast_password_change_error_title"),description:b("toast_password_change_error_desc")}),e}}},L=async e=>{if(!a||!(null==x?void 0:x.db))return;let t=(0,l.JU)(x.db,"users",a.uid);await (0,l.r7)(t,{balance:(0,l.nP)(e)}),_({title:"Balance Added",description:"HK$".concat(e.toFixed(2)," was added to your account.")})},M=async()=>{if(!a||!(null==x?void 0:x.db))return;let e=(0,l.JU)(x.db,"users",a.uid);await (0,l.r7)(e,{deposit:100}),_({title:"Deposit Paid",description:"Your HK$100 deposit has been successfully recorded."})},k=async()=>{if(!a||!(null==x?void 0:x.db))return;let e=(0,l.JU)(x.db,"users",a.uid);await (0,l.r7)(e,{hasHadFirstFreeRental:!0})},J=async e=>{if(!a||!(null==x?void 0:x.db))return;let t=(0,l.JU)(x.db,"users",a.uid),r=(0,l.JU)(x.db,"stalls",e.stallId),s=await (0,l.QT)(r);if(!s.exists()||s.data().availableUmbrellas<=0){_({variant:"destructive",title:"Rental Failed",description:"No umbrellas available at this stall."});return}let i={...e,logs:[]},n=(0,l.qs)(x.db);n.update(t,{activeRental:i}),n.update(r,{availableUmbrellas:(0,l.nP)(-1),nextActionSlot:(0,l.nP)(1)}),await n.commit(),_({title:"Rental Started!",description:"You have rented an umbrella from ".concat(e.stallName,".")})},G=async e=>{if(!a||!w||!(null==x?void 0:x.db))return;let t=(0,l.JU)(x.db,"users",a.uid),r=(0,l.JU)(x.db,"stalls",e),s=await (0,l.QT)(r);if(!s.exists()){_({variant:"destructive",title:"Return Failed",description:"Could not find the stall to return to."});return}let i=s.data(),n=Date.now(),o=(n-w.startTime)/36e5,u=w.isFree?0:Math.min(100,5*Math.ceil(o)),c=(0,l.JU)((0,l.hJ)(x.db,"rentals")),d={...w,rentalId:c.id,userId:a.uid,endTime:n,durationHours:o,finalCost:u,returnedToStallId:e,returnedToStallName:i.name,logs:w.logs||[]},f=(0,l.qs)(x.db);f.set(c,d),f.update(t,{activeRental:null,balance:(0,l.nP)(-u)}),f.update(r,{availableUmbrellas:(0,l.nP)(1),nextActionSlot:(0,l.nP)(1)}),await f.commit()},B=async e=>{let{stallId:t,type:r,message:s}=e;if((!(null==a?void 0:a.uid)||!w||!(null==x?void 0:x.db))&&(!(null==a?void 0:a.uid)||!(null==x?void 0:x.db))){console.warn("Cannot log machine event: no user or no DB service.");return}let i=(0,l.JU)(x.db,"users",a.uid),n={type:r,message:s,timestamp:Date.now()},o=t||(null==w?void 0:w.stallId);if(!o){console.error("LogMachineEvent: stallId is missing and could not be inferred from active rental.");return}w?await (0,l.r7)(i,{"activeRental.logs":(0,l.vr)(n)}):console.log("[Machine Event Log - No Active Rental] User: ".concat(a.uid,", Stall: ").concat(o,", Type: ").concat(r,", Message: ").concat(s))},K=a?{...a,...f,uid:a.uid}:null;return(0,r.jsx)(p.Provider,{value:{user:K,isReady:m,loading:!m||!!a&&!f,activeRental:w,isLoadingRental:I||!!a&&!f,startRental:J,endRental:G,signInWithGoogle:D,signInWithApple:R,signUpWithEmail:U,signInWithEmail:O,signOut:j,changeUserPassword:P,addBalance:L,setDeposit:M,useFirstFreeRental:k,showSignUpSuccess:y,dismissSignUpSuccess:()=>S(!1),logMachineEvent:B,firebaseServices:x},children:t})}function g(){let e=(0,s.useContext)(p);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},6862:function(e,t,a){a.d(t,{pm:function(){return f}});var r=a(2265);let s=0,i=new Map,n=e=>{if(i.has(e))return;let t=setTimeout(()=>{i.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);i.set(e,t)},l=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?n(a):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},o=[],u={toasts:[]};function c(e){u=l(u,e),o.forEach(e=>{e(u)})}function d(e){let{...t}=e,a=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>c({type:"DISMISS_TOAST",toastId:a});return c({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||r()}}}),{id:a,dismiss:r,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function f(){let[e,t]=r.useState(u);return r.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:d,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},1221:function(e,t,a){a.d(t,{I:function(){return u},q:function(){return l}});var r=a(6142),s=a(7065),i=a(8121),n=a(1776);let l={apiKey:"AIzaSyDk8gmZb-azt0fndBG80zrYXEma7NsUdL0",authDomain:"udry-app-dev.firebaseapp.com",projectId:"udry-app-dev",storageBucket:"udry-app-dev.firebasestorage.app",messagingSenderId:"458603936715",appId:"1:458603936715:web:8c50687fc1cdcf9c90944e",measurementId:"G-X1VP807J0N"};setTimeout(()=>{let e;let t="color: green; font-weight: bold;",a="color: red; font-weight: bold;",o="color: blue; font-weight: bold;";if(console.log("%c--- STARTING FIREBASE CLIENT DIAGNOSTICS ---",o),l.apiKey&&l.projectId&&"YOUR_KEY_HERE"!==l.apiKey)console.log("%c[DIAGNOSTIC] PASSED: Firebase config variables are present.",t);else{console.error("%c[DIAGNOSTIC] FAILED: Firebase config is not fully set in environment variables (check .env file).",a),console.log("Current Config:",l);return}try{if(!(e=(0,r.C6)().length>0?(0,r.Mq)():(0,r.ZF)(l)))throw Error("initializeApp() did not return a valid app object.");console.log("%c[DIAGNOSTIC] PASSED: Firebase App initialized successfully for project: ".concat(e.options.projectId),t)}catch(e){console.error("%c[DIAGNOSTIC] FAILED: Firebase App initialization failed.",a,e.message);return}try{let a=(0,s.v0)(e),r=(0,i.ad)(e),l=(0,n.$C)(e);if(!a||!r||!l)throw Error("One or more services (Auth, Firestore, Functions) returned null or undefined.");console.log("%c[DIAGNOSTIC] PASSED: Successfully got references to Auth, Firestore, and Functions services.",t)}catch(e){console.error("%c[DIAGNOSTIC] FAILED: Could not get individual Firebase services.",a,e.message);return}console.log("%c--- FIREBASE CLIENT DIAGNOSTICS COMPLETE ---",o)},0);let o=null;function u(){if(o)return o;if(!(l.apiKey&&l.projectId&&"YOUR_KEY_HERE"!==l.apiKey))return null;try{let e=(0,r.C6)().length>0?(0,r.Mq)():(0,r.ZF)(l),t=(0,i.ad)(e),a=(0,s.v0)(e),u=(0,n.$C)(e);return o={app:e,auth:a,db:t,functions:u}}catch(e){return null}}}}]);