rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Stalls are public and can be read by anyone to display on the map.
    // Only admins should be able to create, update, or delete them.
    match /stalls/{stallId} {
      allow read;
      allow write: if request.auth != null && request.auth.token.email == 'admin@u-dry.com';
    }

    // Users can get and update their own document.
    // The admin user is specifically granted the ability to list all users for the admin panel.
    match /users/{userId} {
      allow get, update: if request.auth != null && request.auth.uid == userId;
      allow list: if request.auth != null && request.auth.token.email == 'admin@u-dry.com';
    }
    
    // Processed Stripe payments should be private.
    match /processed_stripe_payments/{paymentId} {
      allow read, write: if false; // Secure by default
    }

    // Rental history should only be listable by an admin.
    // In the future, we could add rules for users to read their own rentals.
    match /rentals/{rentalId} {
       allow read: if request.auth != null && request.auth.token.email == 'admin@u-dry.com';
       allow list: if request.auth != null && request.auth.token.email == 'admin@u-dry.com';
       allow write: if false; // Should only be written by backend functions
    }
  }
}
